---
name: init
description: "Initialize orchestrator session — pull Linear, load previous context, present dispatch queue"
disable-model-invocation: true
argument-hint: "[ROK-XXX]"
allowed-tools: "Read, Write, Glob, Grep, Bash(git status*), Bash(git log*), Bash(git diff*), mcp__linear__list_issues, mcp__linear__get_issue, mcp__linear__list_cycles"
---

# Session Init

Initialize the orchestrator session. Pull current state from Linear, load previous session context, regenerate local caches, and present the dispatch queue.

**You are the orchestrator.** Your job is to coordinate with the operator (user) to manage parallel subagents via `/dispatch`. You don't implement stories directly.

**Linear Project:** Raid Ledger (ID: `1bc39f98-abaa-4d85-912f-ba62c8da1532`)
**Team:** Roknua's projects (ID: `0728c19f-5268-4e16-aa45-c944349ce386`)

---

## Step 1 — Parallel Data Gathering

Fetch ALL in a single parallel block:

1. `mcp__linear__list_issues(project: "Raid Ledger", limit: 250)`
2. `mcp__linear__list_cycles(teamId: "0728c19f-5268-4e16-aa45-c944349ce386", type: "current")`
3. Read `planning-artifacts/session-notes.md` (may not exist — that's fine)
4. `git status --porcelain` and `git log --oneline -10`
5. **If `$ARGUMENTS` matches `ROK-NNN`:** also `mcp__linear__get_issue(id: "$ARGUMENTS")`

---

## Step 2 — Previous Session Context

If `session-notes.md` exists, display its contents under a "Previous Session" heading. This preserves key insights across context resets. If it doesn't exist, skip silently.

---

## Step 3 — Regenerate Local Caches

### 3a. sprint-status.yaml

Overwrite `planning-artifacts/sprint-status.yaml` from Linear data:

```yaml
# generated: <ISO-8601>
# source: Linear (Raid Ledger) — do not hand-edit
project: Raid Ledger

current_sprint:   # omit block if no active cycle
  name: "<cycle name>"
  number: <N>
  starts: "<YYYY-MM-DD>"
  ends: "<YYYY-MM-DD>"
  progress: "<done>/<total>"
  stories:
    - ROK-XXX    # <title> (<status>)

development_status:
  # === Done ===
  ROK-XXX: done           # <title>
  # === In Review ===
  ROK-XXX: review         # <title>
  # === Changes Requested ===
  ROK-XXX: changes-requested  # <title>
  # === In Progress ===
  ROK-XXX: in-progress    # <title>
  # === Dispatch Ready ===
  ROK-XXX: dispatch-ready # <title>
  # === Ready for Dev ===
  ROK-XXX: ready-for-dev  # <title>
  # === Backlog ===
  ROK-XXX: backlog        # <title>
  # === Deprecated ===
  ROK-XXX: deprecated     # <title>
```

**Status mapping:** Done→`done`, In Progress→`in-progress`, Todo→`ready-for-dev`, Dispatch Ready→`dispatch-ready`, In Review→`review`, Changes Requested→`changes-requested`, Backlog→`backlog`, Canceled→`deprecated`, Duplicate→skip.

Sort by ROK number within groups. Omit empty groups.

### 3b. task.md

Overwrite `task.md` — keep it minimal, the orchestrator tracks dispatch state not individual story work:

```markdown
# Session: <YYYY-MM-DD>
<!-- Generated by /init from Linear -->

## Active Work
<!-- Stories currently being worked on by agents or in review -->
- [/] ROK-XXX: <title> (In Progress|In Review|Changes Requested)

## Dispatch Queue
<!-- Stories ready for parallel dispatch -->
- [ ] ROK-XXX: <title>  (P1) — Dispatch Ready
- [ ] ROK-XXX: <title>  (P2) — Dispatch Ready

## Todo → Dispatch Candidates
<!-- Stories in Todo that may be ready for dispatch. Review and move to Dispatch Ready. -->
- [ ] ROK-XXX: <title>  (P1)

## Session Notes
<!-- Key decisions, blockers, context for next session -->
```

Populate sections:
- **Active Work:** In Progress + In Review + Changes Requested stories, sorted by ROK number
- **Dispatch Queue:** Dispatch Ready stories, sorted by priority then ROK number
- **Todo → Dispatch Candidates:** Todo stories, sorted by priority then ROK number. Include priority: `(P0)` Urgent, `(P1)` High, `(P2)` Normal, `(P3)` Low.

---

## Step 4 — Present Dashboard

Output a compact dashboard:

```
Session Init | <YYYY-MM-DD>
Sprint: <name> | <start> → <end> | <done>/<total> done | Z days left
   (or: "No active sprint")

Git: <branch> | <clean/dirty>
Recent: <latest commit one-liner>
Linear: <total> issues synced

=== Pipeline ===
In Review:    N stories
Rework:       N stories (Changes Requested)
Dispatching:  N stories (Dispatch Ready)
Todo:         N stories (candidates for dispatch)
Backlog:      N stories

=== Dispatch Queue ===
| Story | Pri | Title |
|-------|-----|-------|
| ROK-XXX | P1 | <title> |

=== Todo → Dispatch Candidates ===
| Story | Pri | Title | Dispatch Ready? |
|-------|-----|-------|-----------------|
| ROK-XXX | P1 | <title> | Yes — full spec |
| ROK-YYY | P2 | <title> | Needs planning — no technical approach |
| ROK-ZZZ | P2 | <title> | Blocked — depends on ROK-AAA |
```

### Dispatch Readiness Assessment

For each Todo story, briefly assess if it's ready to move to Dispatch Ready:
- **Yes** — has clear ACs, technical approach, and enough detail
- **Needs planning** — missing technical approach, vague ACs, or ambiguous scope (the `/dispatch` skill will handle planning via subagents)
- **Blocked** — has unmet dependencies on other stories

### If `$ARGUMENTS` matches `ROK-NNN`

Append a focus section with the Linear issue details (title, status, description preview, priority).

### Closing Prompt

End with: **"Ready to `/dispatch`, move stories, or discuss priorities?"**

This sets up the operator to either:
1. Move Todo candidates to Dispatch Ready
2. Run `/dispatch` to plan and spawn agents
3. Discuss priorities or story details first
